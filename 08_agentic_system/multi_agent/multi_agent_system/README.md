# ä¼ä¸šçº§å¤šæ™ºèƒ½ä½“ AI ç³»ç»Ÿ

> åŸºäºã€Šå¤šæ™ºèƒ½ä½“ AI ç³»ç»ŸåŸºç¡€ï¼šç†è®ºä¸æ¡†æ¶ã€‹æ„å»ºçš„ç”Ÿäº§çº§å¤šæ™ºèƒ½ä½“ AI ç³»ç»Ÿï¼Œé›†æˆç°ä»£ AI å·¥å…·é“¾å’Œä¼ä¸šçº§ç‰¹æ€§ã€‚

## 1. é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**ç”Ÿäº§å°±ç»ª**çš„ä¼ä¸šçº§å¤šæ™ºèƒ½ä½“ AI ç³»ç»Ÿï¼Œé‡‡ç”¨ç°ä»£è½¯ä»¶æ¶æ„è®¾è®¡åŸåˆ™ï¼Œå®ç°äº†ï¼š

- **BDI è®¤çŸ¥æ¶æ„**ï¼šå®Œæ•´çš„ä¿¡å¿µ-æ„¿æœ›-æ„å›¾å¾ªç¯å®ç°
- **æ™ºèƒ½ä½“åä½œ**ï¼šä¸“ä¸šåŒ–æ™ºèƒ½ä½“é—´çš„é«˜æ•ˆåä½œæœºåˆ¶
- **å·¥ä½œæµç¼–æ’**ï¼šåŸºäº LangGraph çš„å¤æ‚ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–
- **å…¨é“¾è·¯ç›‘æ§**ï¼šLangSmith é›†æˆçš„æ€§èƒ½è¿½è¸ªå’Œåˆ†æ
- **ä¼ä¸šçº§ç‰¹æ€§**ï¼šé«˜å¯ç”¨ã€å¯æ‰©å±•ã€å¯è§‚æµ‹çš„ç³»ç»Ÿè®¾è®¡

## 2. æ ¸å¿ƒç‰¹æ€§

### 2.1 æ¶æ„è®¾è®¡

- **BDI è®¤çŸ¥æ¶æ„**ï¼šå®Œæ•´çš„ä¿¡å¿µ-æ„¿æœ›-æ„å›¾è®¤çŸ¥å¾ªç¯
- **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šå¼‚æ­¥æ¶ˆæ¯å¤„ç†å’Œå“åº”å¼è®¾è®¡
- **å¾®æœåŠ¡æ¶æ„**ï¼šæ¾è€¦åˆã€é«˜å†…èšçš„æ¨¡å—åŒ–è®¾è®¡
- **SOLID åŸåˆ™**ï¼šéµå¾ªé¢å‘å¯¹è±¡è®¾è®¡æœ€ä½³å®è·µ

### 2.2 æ™ºèƒ½ä½“èƒ½åŠ›

- **ä¸“ä¸šåŒ–æ™ºèƒ½ä½“**ï¼šç ”ç©¶ã€åˆ†æã€å®¢æœç­‰é¢†åŸŸä¸“å®¶
- **åä½œæœºåˆ¶**ï¼šæ™ºèƒ½ä½“é—´çš„é«˜æ•ˆåä½œå’Œä»»åŠ¡åˆ†é…
- **æ’ä»¶åŒ–æ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰æ™ºèƒ½ä½“å’Œèƒ½åŠ›æ‰©å±•
- **è§’è‰²é€‚é…**ï¼šåŠ¨æ€è§’è‰²åˆ‡æ¢å’Œèƒ½åŠ›ç»„åˆ

### 2.3 æŠ€æœ¯æ ˆ

- **LangGraph å·¥ä½œæµ**ï¼šå¤æ‚ä¸šåŠ¡æµç¨‹çš„å¯è§†åŒ–ç¼–æ’
- **LangSmith ç›‘æ§**ï¼šå…¨é“¾è·¯è¿½è¸ªå’Œæ€§èƒ½åˆ†æ
- **FastAPI æ¡†æ¶**ï¼šé«˜æ€§èƒ½å¼‚æ­¥ Web API
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDocker + Kubernetes ç”Ÿäº§éƒ¨ç½²ï¼ˆdemo é‡‡ç”¨ docker composeï¼‰

### 2.4 ä¼ä¸šçº§ç‰¹æ€§

- **é«˜å¯ç”¨æ€§**ï¼šæ•…éšœæ¢å¤å’Œè´Ÿè½½å‡è¡¡
- **å®‰å…¨è®¤è¯**ï¼šAPI å¯†é’¥å’Œè®¿é—®æ§åˆ¶
- **å¯è§‚æµ‹æ€§**ï¼šæ—¥å¿—ã€æŒ‡æ ‡ã€é“¾è·¯è¿½è¸ª
- **é«˜æ€§èƒ½**ï¼šå¼‚æ­¥å¤„ç†å’Œèµ„æºä¼˜åŒ–

---

## 3. é¡¹ç›®ç»“æ„

```bash
multi_agent_system/
â”œâ”€â”€ ğŸ“‚ src/                           # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ ğŸ¤– agents/                    # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ base_agent.py            # ğŸ§  BDIåŸºç¡€æ™ºèƒ½ä½“æ¶æ„
â”‚   â”‚   â”œâ”€â”€ research_agent.py        # ğŸ”¬ ç ”ç©¶ä¸“å®¶æ™ºèƒ½ä½“
â”‚   â”‚   â””â”€â”€ analysis_agent.py        # ğŸ“Š åˆ†æä¸“å®¶æ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ ğŸ“¡ communication/             # é€šä¿¡ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ message_bus.py           # ğŸšŒ ä¼ä¸šçº§æ¶ˆæ¯æ€»çº¿
â”‚   â”œâ”€â”€ ğŸ”„ workflows/                 # å·¥ä½œæµå¼•æ“
â”‚   â”‚   â””â”€â”€ langgraph_workflow.py    # ğŸŒŠ LangGraphå·¥ä½œæµç¼–æ’
â”‚   â”œâ”€â”€ ğŸ¯ examples/                  # åº”ç”¨ç¤ºä¾‹
â”‚   â”‚   â””â”€â”€ customer_service_system.py # ğŸ§ æ™ºèƒ½å®¢æœç³»ç»Ÿ
â”‚   â””â”€â”€ ğŸš€ main.py                   # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ ğŸ§ª tests/                        # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ test_system.py              # ğŸ” ç³»ç»Ÿé›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_interactions.py        # ğŸ”„ äº¤äº’åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_api_server.py          # ğŸš€ API æœåŠ¡å™¨æµ‹è¯•
â”‚   â””â”€â”€ test_api_client.py          # ğŸ“¡ API å®¢æˆ·ç«¯æµ‹è¯•
â”œâ”€â”€ âš™ï¸ config.json                   # ç³»ç»Ÿé…ç½®æ–‡ä»¶
â”œâ”€â”€ ğŸ“¦ requirements.txt              # Pythonä¾èµ–æ¸…å•
â”œâ”€â”€ ğŸ³ Dockerfile                    # å®¹å™¨åŒ–é…ç½®
â”œâ”€â”€ ğŸ™ docker-compose.yml           # å¤šæœåŠ¡ç¼–æ’
â””â”€â”€ ğŸ“– README.md                     # é¡¹ç›®æ–‡æ¡£
```

### 3.1 ç›®å½•è¯´æ˜

| ç›®å½•/æ–‡ä»¶            | åŠŸèƒ½æè¿°       | å…³é”®ç‰¹æ€§                               |
| -------------------- | -------------- | -------------------------------------- |
| `src/agents/`        | æ™ºèƒ½ä½“æ ¸å¿ƒå®ç° | BDI æ¶æ„ã€ä¸“ä¸šåŒ–èƒ½åŠ›ã€åä½œæœºåˆ¶         |
| `src/communication/` | é€šä¿¡åŸºç¡€è®¾æ–½   | æ¶ˆæ¯æ€»çº¿ã€å‘å¸ƒè®¢é˜…ã€è¯·æ±‚å“åº”           |
| `src/workflows/`     | å·¥ä½œæµå¼•æ“     | LangGraph é›†æˆã€æµç¨‹ç¼–æ’ã€çŠ¶æ€ç®¡ç†     |
| `src/examples/`      | ä¸šåŠ¡åº”ç”¨ç¤ºä¾‹   | æ™ºèƒ½å®¢æœã€ç ”ç©¶åˆ†æã€æœ€ä½³å®è·µ           |
| `tests/`             | æµ‹è¯•è¦†ç›–       | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€API æµ‹è¯• |
| `config.json`        | é…ç½®ç®¡ç†       | ç¯å¢ƒé…ç½®ã€API å¯†é’¥ã€ç³»ç»Ÿå‚æ•°           |

---

## 4. ç³»ç»Ÿæ¶æ„

### 4.1 åˆ†å±‚æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "ğŸ–¥ï¸ è¡¨ç¤ºå±‚"
        UI["ğŸŒ Webç•Œé¢"]
        API["ğŸš€ REST API"]
        CLI["ğŸ’» å‘½ä»¤è¡Œ"]
    end

    subgraph "ğŸ¯ åº”ç”¨å±‚"
        Gateway["ğŸšª APIç½‘å…³"]
        Auth["ğŸ” è®¤è¯æˆæƒ"]
        Router["ğŸ”€ è¯·æ±‚è·¯ç”±"]
    end

    subgraph "ğŸ¤– æ™ºèƒ½ä½“å±‚"
        Orchestrator["ğŸ¼ æ™ºèƒ½ä½“ç¼–æ’å™¨"]
        Research["ğŸ”¬ ç ”ç©¶æ™ºèƒ½ä½“"]
        Analysis["ğŸ“Š åˆ†ææ™ºèƒ½ä½“"]
        Customer["ğŸ§ å®¢æœæ™ºèƒ½ä½“"]
    end

    subgraph "ğŸ”„ å·¥ä½œæµå±‚"
        LangGraph["ğŸŒŠ LangGraphå¼•æ“"]
        StateManager["ğŸ“‹ çŠ¶æ€ç®¡ç†"]
        TaskQueue["ğŸ“ ä»»åŠ¡é˜Ÿåˆ—"]
    end

    subgraph "ğŸ“¡ é€šä¿¡å±‚"
        MessageBus["ğŸšŒ æ¶ˆæ¯æ€»çº¿"]
        PubSub["ğŸ“¢ å‘å¸ƒè®¢é˜…"]
        ReqRes["ğŸ”„ è¯·æ±‚å“åº”"]
    end

    subgraph "ğŸ’¾ æ•°æ®å±‚"
        Memory["ğŸ§  å†…å­˜å­˜å‚¨"]
        Cache["âš¡ ç¼“å­˜å±‚"]
        Persistence["ğŸ’¿ æŒä¹…åŒ–"]
    end

    subgraph "ğŸ“Š ç›‘æ§å±‚"
        LangSmith["ğŸ” LangSmith"]
        Metrics["ğŸ“ˆ æŒ‡æ ‡æ”¶é›†"]
        Logging["ğŸ“ æ—¥å¿—ç³»ç»Ÿ"]
    end

    UI --> Gateway
    API --> Gateway
    CLI --> Gateway

    Gateway --> Orchestrator
    Auth --> Orchestrator
    Router --> Orchestrator

    Orchestrator --> Research
    Orchestrator --> Analysis
    Orchestrator --> Customer

    Research --> LangGraph
    Analysis --> LangGraph
    Customer --> LangGraph

    LangGraph --> MessageBus
    StateManager --> MessageBus
    TaskQueue --> MessageBus

    MessageBus --> Memory
    PubSub --> Cache
    ReqRes --> Persistence

    LangSmith --> Metrics
    Metrics --> Logging
```

### 4.2 æ ¸å¿ƒç»„ä»¶è¯´æ˜

| å±‚çº§         | ç»„ä»¶           | èŒè´£               | æŠ€æœ¯æ ˆ                |
| ------------ | -------------- | ------------------ | --------------------- |
| **è¡¨ç¤ºå±‚**   | Web ç•Œé¢/API   | ç”¨æˆ·äº¤äº’ã€æ¥å£æš´éœ² | FastAPI, Streamlit    |
| **åº”ç”¨å±‚**   | API ç½‘å…³       | è¯·æ±‚è·¯ç”±ã€è®¤è¯æˆæƒ | FastAPI, JWT          |
| **æ™ºèƒ½ä½“å±‚** | ä¸“ä¸šæ™ºèƒ½ä½“     | ä¸šåŠ¡é€»è¾‘ã€AI æ¨ç†  | LangChain, OpenAI     |
| **å·¥ä½œæµå±‚** | LangGraph å¼•æ“ | æµç¨‹ç¼–æ’ã€çŠ¶æ€ç®¡ç† | LangGraph, StateGraph |
| **é€šä¿¡å±‚**   | æ¶ˆæ¯æ€»çº¿       | å¼‚æ­¥é€šä¿¡ã€äº‹ä»¶é©±åŠ¨ | asyncio, Queue        |
| **æ•°æ®å±‚**   | å­˜å‚¨ç®¡ç†       | æ•°æ®æŒä¹…åŒ–ã€ç¼“å­˜   | Redis, PostgreSQL     |
| **ç›‘æ§å±‚**   | å¯è§‚æµ‹æ€§       | è¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿—   | LangSmith, Prometheus |

---

## 5. å¿«é€Ÿå¼€å§‹

### 5.1 ä¸€é”®å¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd multi_agent_system
```

#### 5.1.1 æ–¹å¼ä¸€ï¼šDocker Compose å¯åŠ¨ï¼ˆè¾ƒå¤æ‚ï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

**å¯è®¿é—®çš„æœåŠ¡ï¼š**

| æœåŠ¡                | åœ°å€                         | ç”¨é€”                   |
| ------------------- | ---------------------------- | ---------------------- |
| ğŸŒ Web ç•Œé¢         | <http://localhost:8501>      | Streamlit ç”¨æˆ·ç•Œé¢     |
| ğŸš€ API æ–‡æ¡£         | <http://localhost:8000/docs> | FastAPI Swagger æ–‡æ¡£   |
| ğŸ“Š Grafana é¢æ¿     | <http://localhost:3000>      | ç›‘æ§é¢æ¿ (admin/admin) |
| ğŸ” Prometheus       | <http://localhost:9090>      | æŒ‡æ ‡æ”¶é›†               |
| ğŸ“ Jupyter Notebook | <http://localhost:8888>      | å¼€å‘ç¯å¢ƒ               |
| ğŸŒ Nginx ä»£ç†       | <http://localhost:80>        | åå‘ä»£ç†               |

#### 5.1.2 æ–¹å¼äºŒï¼šPython æœ¬åœ°å¯åŠ¨ï¼ˆäº¤äº’å¼æ–¹å¼ï¼‰

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨ä¸»åº”ç”¨
python main.py

# æˆ–æŒ‡å®šå‚æ•°å¯åŠ¨
python main.py --log-level INFO --demo research
python main.py --demo customer_service
python main.py --metrics
python main.py --interactive
```

**ç³»ç»ŸåŠŸèƒ½ï¼š**

| åŠŸèƒ½            | æè¿°           | ç”¨é€”                 |
| --------------- | -------------- | -------------------- |
| ğŸ¤– å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ | æ ¸å¿ƒæ™ºèƒ½ä½“æ¡†æ¶ | æ™ºèƒ½ä½“åä½œã€ä»»åŠ¡å¤„ç† |
| ğŸ“Š æ¶ˆæ¯æ€»çº¿     | æ™ºèƒ½ä½“é—´é€šä¿¡   | æ¶ˆæ¯ä¼ é€’ã€äº‹ä»¶å¤„ç†   |
| ğŸ”„ å·¥ä½œæµå¼•æ“   | LangGraph é›†æˆ | å¤æ‚ä»»åŠ¡ç¼–æ’         |
| ğŸ“ˆ ç›‘æ§è¿½è¸ª     | LangSmith é›†æˆ | æ€§èƒ½ç›‘æ§ã€è°ƒè¯•è¿½è¸ª   |

**æ³¨æ„ï¼š** Python æœ¬åœ°å¯åŠ¨æ–¹å¼å¯åŠ¨å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡ï¼Œä¸åŒ…å« Web API æ¥å£ã€‚å¦‚éœ€ API æœåŠ¡ï¼Œè¯·ä½¿ç”¨æ–¹å¼ä¸‰çš„ API æœåŠ¡å™¨æµ‹è¯•å¯åŠ¨ã€‚

#### 5.1.3 æ–¹å¼ä¸‰ï¼šAPI æœåŠ¡å™¨æµ‹è¯•å¯åŠ¨

å¦‚æœæ‚¨éœ€è¦ä¸“é—¨å¯åŠ¨ FastAPI æœåŠ¡å™¨è¿›è¡Œ API æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å¯åŠ¨ API æœåŠ¡å™¨ï¼ˆä¸“ç”¨äºæµ‹è¯•ï¼‰
python tests/test_api_server.py
```

**æœåŠ¡å™¨åŠŸèƒ½ï¼š**

- ğŸŒ å®Œæ•´çš„ FastAPI Web æœåŠ¡å™¨
- ğŸ“¡ æ‰€æœ‰ RESTful API æ¥å£
- ğŸ“Š å®æ—¶ç³»ç»Ÿç›‘æ§å’ŒæŒ‡æ ‡
- ğŸ” è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£
- ğŸ¯ å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€ç«¯ç‚¹

**å¯è®¿é—®åœ°å€ï¼š**

| æœåŠ¡        | åœ°å€                            | ç”¨é€”            |
| ----------- | ------------------------------- | --------------- |
| ğŸš€ API æœåŠ¡ | <http://localhost:8000>         | ä¸»è¦ API æ¥å£   |
| ğŸš€ API æ–‡æ¡£ | <http://localhost:8000/docs>    | Swagger æ–‡æ¡£    |
| ğŸ“– å¤‡ç”¨æ–‡æ¡£ | <http://localhost:8000/redoc>   | ReDoc æ–‡æ¡£      |
| ğŸ“Š å¥åº·æ£€æŸ¥ | <http://localhost:8000/health>  | ç³»ç»ŸçŠ¶æ€        |
| ğŸ“ˆ ç³»ç»ŸæŒ‡æ ‡ | <http://localhost:8000/metrics> | Prometheus æŒ‡æ ‡ |

**é€‚ç”¨åœºæ™¯ï¼š**

- API æ¥å£å¼€å‘å’Œæµ‹è¯•
- å‰ç«¯å¼€å‘æ—¶çš„åç«¯æœåŠ¡
- API æ–‡æ¡£æŸ¥çœ‹å’Œè°ƒè¯•
- ç³»ç»Ÿé›†æˆæµ‹è¯•

### 5.2 ç¯å¢ƒé…ç½®

**å¿…éœ€ç¯å¢ƒï¼š**

- Python 3.11+
- Dockerï¼ˆæ¨èï¼‰

**API å¯†é’¥é…ç½®ï¼š**

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export OPENAI_API_KEY="your-openai-key"
export LANGSMITH_API_KEY="your-langsmith-key"

# æˆ–ç¼–è¾‘ config.json
{
  "openai_api_key": "your-openai-key",
  "langsmith_api_key": "your-langsmith-key"
}
```

### 5.3 æœåŠ¡è®¿é—®è¯´æ˜

æ ¹æ®å¯åŠ¨æ–¹å¼ä¸åŒï¼Œå¯è®¿é—®çš„æœåŠ¡ä¹Ÿæœ‰æ‰€åŒºåˆ«ï¼š

**Docker Compose å¯åŠ¨ï¼ˆå®Œæ•´æœåŠ¡ï¼‰ï¼š**

- ğŸŒ **Web ç•Œé¢**ï¼š<http://localhost:8501> - Streamlit ç”¨æˆ·ç•Œé¢
- ğŸš€ **API æ–‡æ¡£**ï¼š<http://localhost:8000/docs> - FastAPI Swagger æ–‡æ¡£
- ğŸ“Š **Grafana é¢æ¿**ï¼š<http://localhost:3000> - ç›‘æ§é¢æ¿ (admin/admin)
- ğŸ” **Prometheus**ï¼š<http://localhost:9090> - æŒ‡æ ‡æ”¶é›†
- ğŸ“ **Jupyter Notebook**ï¼š<http://localhost:8888> - å¼€å‘ç¯å¢ƒ
- ğŸŒ **Nginx ä»£ç†**ï¼š<http://localhost:80> - åå‘ä»£ç†

**Python æœ¬åœ°å¯åŠ¨ï¼ˆæ ¸å¿ƒæœåŠ¡ï¼‰ï¼š**

- ğŸš€ **API æœåŠ¡**ï¼š<http://localhost:8000> - ä¸»è¦ API æ¥å£
- ğŸš€ **API æ–‡æ¡£**ï¼š<http://localhost:8000/docs> - Swagger æ–‡æ¡£
- ğŸ“Š **å¥åº·æ£€æŸ¥**ï¼š<http://localhost:8000/health> - ç³»ç»ŸçŠ¶æ€
- ğŸ“ˆ **æŒ‡æ ‡æ¥å£**ï¼š<http://localhost:8000/metrics> - Prometheus æŒ‡æ ‡

### 5.4 éªŒè¯å®‰è£…

```bash
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
curl http://localhost:8000/health

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
python tests/test_interactions.py      # åŸºç¡€äº¤äº’æµ‹è¯•
python tests/test_api_server.py        # å¯åŠ¨ API æœåŠ¡å™¨
python tests/test_api_client.py        # API å®¢æˆ·ç«¯æµ‹è¯•
```

### 5.4.1 æµ‹è¯•æ–‡ä»¶è¯´æ˜

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ŒéªŒè¯ç³»ç»Ÿçš„å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼š

#### 5.5.1 ğŸ”„ test_interactions.py - åŸºç¡€äº¤äº’æµ‹è¯•

éªŒè¯å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„æ ¸å¿ƒäº¤äº’åŠŸèƒ½ï¼š

```bash
# è¿è¡ŒåŸºç¡€äº¤äº’æµ‹è¯•
cd /path/to/multi_agent_system
source venv/bin/activate
python tests/test_interactions.py
```

**æµ‹è¯•å†…å®¹ï¼š**

- âœ… ç³»ç»Ÿå¯åŠ¨å’Œå…³é—­
- âœ… æ™ºèƒ½ä½“åˆ›å»ºå’Œé…ç½®
- âœ… åŸºç¡€ä»»åŠ¡æ‰§è¡Œ
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… æ€§èƒ½æŒ‡æ ‡æ”¶é›†

#### 5.5.2 ğŸš€ test_api_server.py - API æœåŠ¡å™¨æµ‹è¯•

å¯åŠ¨å®Œæ•´çš„ FastAPI æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ï¼š

```bash
# å¯åŠ¨ API æœåŠ¡å™¨ï¼ˆé˜»å¡æ¨¡å¼ï¼‰
python tests/test_api_server.py
```

**æœåŠ¡å™¨åŠŸèƒ½ï¼š**

- ğŸŒ FastAPI Web æœåŠ¡å™¨
- ğŸ“¡ RESTful API æ¥å£
- ğŸ“Š å®æ—¶ç³»ç»Ÿç›‘æ§
- ğŸ” API æ–‡æ¡£ç”Ÿæˆ
- ğŸ¯ å¥åº·æ£€æŸ¥ç«¯ç‚¹

**å¯è®¿é—®åœ°å€ï¼š**

- API æ–‡æ¡£ï¼š<http://localhost:8000/docs>
- å¤‡ç”¨æ–‡æ¡£ï¼š<http://localhost:8000/redoc>
- å¥åº·æ£€æŸ¥ï¼š<http://localhost:8000/health>
- ç³»ç»ŸæŒ‡æ ‡ï¼š<http://localhost:8000/metrics>

#### 5.5.3 ğŸ“¡ test_api_client.py - API å®¢æˆ·ç«¯æµ‹è¯•

éªŒè¯æ‰€æœ‰ API æ¥å£çš„åŠŸèƒ½ï¼š

```bash
# è¿è¡Œ API å®¢æˆ·ç«¯æµ‹è¯•ï¼ˆéœ€è¦å…ˆå¯åŠ¨æœåŠ¡å™¨ï¼‰
python tests/test_api_client.py
```

**æµ‹è¯•æ¥å£ï¼š**

- âœ… å¥åº·æ£€æŸ¥ (`GET /health`)
- âœ… åˆ›å»ºç ”ç©¶ä»»åŠ¡ (`POST /tasks`)
- âœ… æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ (`GET /tasks/{task_id}`)
- âœ… æ•°æ®åˆ†æ (`POST /analysis`)
- âœ… æ™ºèƒ½å®¢æœå¯¹è¯ (`POST /chat`)
- âœ… ç³»ç»Ÿç›‘æ§ (`GET /metrics`)

#### 5.5.4 ğŸ” test_system.py - ç³»ç»Ÿé›†æˆæµ‹è¯•

åŸæœ‰çš„ç³»ç»Ÿé›†æˆæµ‹è¯•ï¼Œä½¿ç”¨ pytest æ¡†æ¶ï¼š

```bash
# è¿è¡Œ pytest æµ‹è¯•
python -m pytest tests/test_system.py -v
```

#### 5.5.5 ğŸ“‹ æµ‹è¯•æ‰§è¡Œé¡ºåºå»ºè®®

1. **åŸºç¡€åŠŸèƒ½éªŒè¯**ï¼š

   ```bash
   python tests/test_interactions.py
   ```

2. **å¯åŠ¨ API æœåŠ¡å™¨**ï¼ˆæ–°ç»ˆç«¯ï¼‰ï¼š

   ```bash
   python tests/test_api_server.py
   ```

3. **éªŒè¯ API æ¥å£**ï¼ˆå¦ä¸€ä¸ªæ–°ç»ˆç«¯ï¼‰ï¼š

   ```bash
   python tests/test_api_client.py
   ```

4. **è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶**ï¼š

   ```bash
   python -m pytest tests/ -v
   ```

> ğŸ’¡ **æç¤º**ï¼šAPI å®¢æˆ·ç«¯æµ‹è¯•éœ€è¦å…ˆå¯åŠ¨ API æœåŠ¡å™¨ï¼Œå»ºè®®åœ¨ä¸åŒç»ˆç«¯çª—å£ä¸­è¿è¡Œã€‚

## 5.5 ä½¿ç”¨æŒ‡å—

### 5.5.1 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½        | æ¥å£             | ç¤ºä¾‹               |
| ----------- | ---------------- | ------------------ |
| ğŸ”¬ ç ”ç©¶ä»»åŠ¡ | `POST /tasks`    | å¸‚åœºåˆ†æã€æŠ€æœ¯è°ƒç ” |
| ğŸ“Š æ•°æ®åˆ†æ | `POST /analysis` | ç”¨æˆ·è¡Œä¸ºã€è¶‹åŠ¿é¢„æµ‹ |
| ğŸ§ æ™ºèƒ½å®¢æœ | `POST /chat`     | é—®ç­”ã€å·¥å•å¤„ç†     |
| ğŸ“ˆ ç³»ç»Ÿç›‘æ§ | `GET /metrics`   | æ€§èƒ½æŒ‡æ ‡ã€å¥åº·æ£€æŸ¥ |

### 6.2 API ä½¿ç”¨ç¤ºä¾‹

#### 6.2.1 è®¤è¯é…ç½®

**ç¯å¢ƒå˜é‡è®¾ç½®ï¼š**

```bash
# è®¾ç½® API å¯†é’¥
export OPENAI_API_KEY="your-openai-api-key"
export LANGSMITH_API_KEY="your-langsmith-api-key"

# æˆ–ä½¿ç”¨é…ç½®æ–‡ä»¶
cp config.json.example config.json
# ç¼–è¾‘ config.json æ–‡ä»¶ï¼Œå¡«å…¥ç›¸åº”çš„ API å¯†é’¥
```

**API è¯·æ±‚å¤´ï¼š**

```bash
# æ‰€æœ‰ API è¯·æ±‚éƒ½éœ€è¦åŒ…å«ä»¥ä¸‹è¯·æ±‚å¤´
-H "Content-Type: application/json"
-H "Accept: application/json"
```

#### 6.2.2 ç ”ç©¶ä»»åŠ¡ API

**åˆ›å»ºç ”ç©¶ä»»åŠ¡ï¼š**

```bash
curl -X POST "http://localhost:8000/tasks" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "type": "research",
    "query": "äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸçš„åº”ç”¨å‰æ™¯",
    "priority": "high",
    "context": {
      "domain": "healthcare",
      "timeframe": "2024-2025",
      "depth": "comprehensive"
    }
  }'
```

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**

```json
{
  "status": "success",
  "data": {
    "task_id": "task_12345",
    "type": "research",
    "status": "created",
    "priority": "high",
    "created_at": "2024-01-15T10:30:00Z",
    "estimated_completion": "2024-01-15T10:35:00Z"
  },
  "message": "ç ”ç©¶ä»»åŠ¡åˆ›å»ºæˆåŠŸ"
}
```

**æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼š**

```bash
curl -X GET "http://localhost:8000/tasks/task_12345" \
  -H "Accept: application/json"
```

**ä»»åŠ¡çŠ¶æ€å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "status": "success",
  "data": {
    "task_id": "task_12345",
    "type": "research",
    "status": "completed",
    "progress": 100,
    "result": {
      "summary": "äººå·¥æ™ºèƒ½åœ¨åŒ»ç–—é¢†åŸŸå±•ç°å‡ºå·¨å¤§æ½œåŠ›...",
      "key_findings": [
        "AI è¯Šæ–­å‡†ç¡®ç‡æå‡ 15-20%",
        "è¯ç‰©ç ”å‘å‘¨æœŸç¼©çŸ­ 30%",
        "åŒ»ç–—æˆæœ¬é™ä½ 25%"
      ],
      "recommendations": ["åŠ å¼º AI åŒ»ç–—ç›‘ç®¡æ¡†æ¶å»ºè®¾", "æ¨è¿›åŒ»ç–—æ•°æ®æ ‡å‡†åŒ–"]
    },
    "created_at": "2024-01-15T10:30:00Z",
    "completed_at": "2024-01-15T10:34:23Z"
  }
}
```

#### 6.2.3 æ•°æ®åˆ†æ API

**åˆ›å»ºåˆ†æä»»åŠ¡ï¼š**

```bash
curl -X POST "http://localhost:8000/analysis" \
  -H "Content-Type: application/json" \
  -d '{
    "data_source": "user_behavior",
    "analysis_type": "trend_prediction",
    "parameters": {
      "time_range": "last_30_days",
      "metrics": ["engagement", "conversion", "retention"],
      "prediction_horizon": "next_7_days"
    }
  }'
```

**åˆ†æç»“æœå“åº”ç¤ºä¾‹ï¼š**

```json
{
  "status": "success",
  "data": {
    "analysis_id": "analysis_67890",
    "type": "trend_prediction",
    "results": {
      "current_trends": {
        "engagement": { "trend": "increasing", "rate": 12.5 },
        "conversion": { "trend": "stable", "rate": 3.2 },
        "retention": { "trend": "decreasing", "rate": -5.1 }
      },
      "predictions": {
        "next_7_days": {
          "engagement": { "predicted_change": "+8.3%", "confidence": 0.87 },
          "conversion": { "predicted_change": "+1.2%", "confidence": 0.92 },
          "retention": { "predicted_change": "-2.1%", "confidence": 0.79 }
        }
      },
      "insights": [
        "ç”¨æˆ·å‚ä¸åº¦æŒç»­ä¸Šå‡ï¼Œå»ºè®®åŠ å¤§å†…å®¹æŠ•å…¥",
        "ç•™å­˜ç‡ä¸‹é™éœ€è¦å…³æ³¨ï¼Œå»ºè®®ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ"
      ]
    },
    "generated_at": "2024-01-15T11:15:30Z"
  }
}
```

#### 6.2.4 æ™ºèƒ½å®¢æœ API

**å‘èµ·å®¢æœå¯¹è¯ï¼š**

```bash
curl -X POST "http://localhost:8000/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘æƒ³äº†è§£ä½ ä»¬çš„ä¼ä¸šç‰ˆå®šä»·æ–¹æ¡ˆ",
    "user_id": "user_123456",
    "session_id": "session_abc789",
    "context": {
      "user_tier": "premium",
      "previous_interactions": 3,
      "preferred_language": "zh-CN"
    }
  }'
```

**å®¢æœå“åº”ç¤ºä¾‹ï¼š**

```json
{
  "status": "success",
  "data": {
    "response": "æ‚¨å¥½ï¼æˆ‘å¾ˆä¹æ„ä¸ºæ‚¨ä»‹ç»ä¼ä¸šç‰ˆå®šä»·æ–¹æ¡ˆã€‚æˆ‘ä»¬æä¾›ä¸‰ä¸ªä¼ä¸šç‰ˆå¥—é¤ï¼š\n\n1. **æ ‡å‡†ä¼ä¸šç‰ˆ**ï¼šï¿¥999/æœˆï¼Œæ”¯æŒ 50 ä¸ªæ™ºèƒ½ä½“\n2. **ä¸“ä¸šä¼ä¸šç‰ˆ**ï¼šï¿¥2999/æœˆï¼Œæ”¯æŒ 200 ä¸ªæ™ºèƒ½ä½“\n3. **æ——èˆ°ä¼ä¸šç‰ˆ**ï¼šï¿¥5999/æœˆï¼Œæ— é™æ™ºèƒ½ä½“\n\næ‰€æœ‰ä¼ä¸šç‰ˆéƒ½åŒ…å«ï¼š7x24 æŠ€æœ¯æ”¯æŒã€ç§æœ‰éƒ¨ç½²é€‰é¡¹ã€å®šåˆ¶åŒ–å¼€å‘æœåŠ¡ã€‚\n\næ‚¨çš„å›¢é˜Ÿè§„æ¨¡å¤§æ¦‚æ˜¯å¤šå°‘äººå‘¢ï¼Ÿæˆ‘å¯ä»¥ä¸ºæ‚¨æ¨èæœ€é€‚åˆçš„æ–¹æ¡ˆã€‚",
    "intent": "pricing_inquiry",
    "sentiment": "neutral",
    "confidence": 0.94,
    "suggested_actions": [
      "schedule_demo",
      "send_pricing_details",
      "connect_sales_team"
    ],
    "session_id": "session_abc789",
    "timestamp": "2024-01-15T11:20:15Z"
  }
}
```

#### 6.2.5 ç³»ç»Ÿç›‘æ§ API

**è·å–ç³»ç»ŸæŒ‡æ ‡ï¼š**

```bash
curl -X GET "http://localhost:8000/metrics" \
  -H "Accept: application/json"
```

**ç³»ç»ŸæŒ‡æ ‡å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "status": "success",
  "data": {
    "system_health": {
      "status": "healthy",
      "uptime": "72h 15m 30s",
      "version": "1.0.0"
    },
    "performance": {
      "cpu_usage": 45.2,
      "memory_usage": 68.7,
      "disk_usage": 23.1,
      "network_io": {
        "bytes_sent": 1024000,
        "bytes_received": 2048000
      }
    },
    "agents": {
      "total_agents": 12,
      "active_agents": 8,
      "idle_agents": 4,
      "average_response_time": "1.2s"
    },
    "tasks": {
      "total_tasks": 156,
      "completed_tasks": 142,
      "pending_tasks": 8,
      "failed_tasks": 6,
      "success_rate": 91.0
    },
    "timestamp": "2024-01-15T11:25:00Z"
  }
}
```

#### 6.2.6 é”™è¯¯å¤„ç†

**å¸¸è§é”™è¯¯å“åº”æ ¼å¼ï¼š**

```json
{
  "status": "error",
  "error": {
    "code": "INVALID_REQUEST",
    "message": "è¯·æ±‚å‚æ•°æ— æ•ˆ",
    "details": {
      "field": "query",
      "issue": "æŸ¥è¯¢å†…å®¹ä¸èƒ½ä¸ºç©º"
    }
  },
  "timestamp": "2024-01-15T11:30:00Z"
}
```

**HTTP çŠ¶æ€ç è¯´æ˜ï¼š**

| çŠ¶æ€ç  | å«ä¹‰       | è¯´æ˜               |
| ------ | ---------- | ------------------ |
| 200    | æˆåŠŸ       | è¯·æ±‚å¤„ç†æˆåŠŸ       |
| 201    | å·²åˆ›å»º     | èµ„æºåˆ›å»ºæˆåŠŸ       |
| 400    | è¯·æ±‚é”™è¯¯   | è¯·æ±‚å‚æ•°æ— æ•ˆ       |
| 401    | æœªæˆæƒ     | API å¯†é’¥æ— æ•ˆæˆ–ç¼ºå¤± |
| 403    | ç¦æ­¢è®¿é—®   | æƒé™ä¸è¶³           |
| 404    | æœªæ‰¾åˆ°     | èµ„æºä¸å­˜åœ¨         |
| 429    | è¯·æ±‚è¿‡å¤š   | è¶…å‡ºé€Ÿç‡é™åˆ¶       |
| 500    | æœåŠ¡å™¨é”™è¯¯ | å†…éƒ¨æœåŠ¡å™¨é”™è¯¯     |
| 503    | æœåŠ¡ä¸å¯ç”¨ | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨     |

### 6.3 Python SDK

#### 6.3.1 åŸºç¡€ä½¿ç”¨

```python
from src.main import MultiAgentSystem
import asyncio
import json

async def main():
    # åˆå§‹åŒ–ç³»ç»Ÿï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
    system = MultiAgentSystem()

    try:
        # å¯åŠ¨ç³»ç»Ÿ
        await system.start()
        print("âœ… å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå¯åŠ¨æˆåŠŸ")

        # ç­‰å¾…ç³»ç»Ÿå®Œå…¨åˆå§‹åŒ–
        await asyncio.sleep(2)

        # è¿è¡Œç¤ºä¾‹ä»»åŠ¡
        await run_examples(system)

    except Exception as e:
        print(f"âŒ ç³»ç»Ÿé”™è¯¯ï¼š{e}")
    finally:
        # ä¼˜é›…å…³é—­ç³»ç»Ÿ
        await system.shutdown()
        print("ğŸ”„ ç³»ç»Ÿå·²å…³é—­")

async def run_examples(system):
    """è¿è¡Œå„ç§ç¤ºä¾‹ä»»åŠ¡"""

    # 1. ç ”ç©¶ä»»åŠ¡ç¤ºä¾‹
    print("\nğŸ”¬ æ‰§è¡Œç ”ç©¶ä»»åŠ¡...")
    research_result = await system.run_research_demo()
    print(f"ç ”ç©¶ç»“æœï¼š{research_result}")

    # 2. å®¢æœç³»ç»Ÿç¤ºä¾‹
    print("\nğŸ§ æ‰§è¡Œå®¢æœå¯¹è¯...")
    customer_result = await system.run_customer_service_demo()
    print(f"å®¢æœç»“æœï¼š{customer_result}")

    # 3. ç³»ç»ŸæŒ‡æ ‡æŸ¥çœ‹
    print("\nğŸ“Š æŸ¥çœ‹ç³»ç»ŸæŒ‡æ ‡...")
    await system.show_metrics()

if __name__ == "__main__":
    asyncio.run(main())
```

#### 6.3.2 è‡ªå®šä¹‰é…ç½®

```python
import json
from pathlib import Path
from src.main import MultiAgentSystem

# åŠ è½½è‡ªå®šä¹‰é…ç½®
config_path = Path("config.json")
with open(config_path, 'r', encoding='utf-8') as f:
    custom_config = json.load(f)

# ä¿®æ”¹é…ç½®å‚æ•°
custom_config.update({
    "system": {
        "name": "My Custom AI System",
        "log_level": "DEBUG",
        "debug": True
    },
    "agents": {
        "max_concurrent_tasks": 10,
        "default_timeout": 60
    }
})

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®åˆå§‹åŒ–ç³»ç»Ÿ
system = MultiAgentSystem(config=custom_config)
```

#### 6.3.3 æ™ºèƒ½ä½“äº¤äº’

```python
from src.agents.research_agent import ResearchAgent
from src.agents.analysis_agent import AnalysisAgent
from src.communication.message_bus import Message, MessageType, MessagePriority

async def agent_interaction_example(system):
    """æ™ºèƒ½ä½“äº¤äº’ç¤ºä¾‹"""

    # è·å–å·²æ³¨å†Œçš„æ™ºèƒ½ä½“
    research_agent = system.agents.get("research_agent")
    analysis_agent = system.agents.get("analysis_agent")

    if research_agent and analysis_agent:
        # åˆ›å»ºç ”ç©¶ä»»åŠ¡
        research_task = {
            "query": "2024å¹´äººå·¥æ™ºèƒ½å‘å±•è¶‹åŠ¿",
            "domain": "technology",
            "depth": "comprehensive"
        }

        # æ‰§è¡Œç ”ç©¶
        research_result = await research_agent.execute(research_task)
        print(f"ğŸ”¬ ç ”ç©¶ç»“æœï¼š{research_result.data}")

        # å°†ç ”ç©¶ç»“æœä¼ é€’ç»™åˆ†ææ™ºèƒ½ä½“
        analysis_task = {
            "data": research_result.data,
            "analysis_type": "trend_analysis",
            "output_format": "structured"
        }

        # æ‰§è¡Œåˆ†æ
        analysis_result = await analysis_agent.execute(analysis_task)
        print(f"ğŸ“Š åˆ†æç»“æœï¼š{analysis_result.data}")

        return {
            "research": research_result.data,
            "analysis": analysis_result.data
        }
```

#### 6.3.4 å·¥ä½œæµç¼–æ’

```python
from src.workflows.langgraph_workflow import EnterpriseWorkflowEngine, EnhancedAgentState

async def workflow_example(system):
    """å·¥ä½œæµç¼–æ’ç¤ºä¾‹"""

    # åˆ›å»ºå·¥ä½œæµå¼•æ“
    workflow_engine = EnterpriseWorkflowEngine(
        tracer=system.tracer,
        message_bus=system.message_bus
    )

    # å®šä¹‰åˆå§‹çŠ¶æ€
    initial_state = EnhancedAgentState(
        task_id="workflow_001",
        task_type="comprehensive_analysis",
        input_data={
            "topic": "ä¼ä¸šæ•°å­—åŒ–è½¬å‹ç­–ç•¥",
            "requirements": [
                "å¸‚åœºè°ƒç ”",
                "ç«äº‰åˆ†æ",
                "æŠ€æœ¯è¯„ä¼°",
                "å®æ–½å»ºè®®"
            ]
        },
        context={"priority": "high", "deadline": "2024-01-20"}
    )

    # æ‰§è¡Œå·¥ä½œæµ
    try:
        final_state = await workflow_engine.execute(initial_state)
        print(f"ğŸŒŠ å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼š{final_state.output_data}")
        return final_state.output_data
    except Exception as e:
        print(f"âŒ å·¥ä½œæµæ‰§è¡Œå¤±è´¥ï¼š{e}")
        return None
```

#### 6.3.5 æ¶ˆæ¯æ€»çº¿ä½¿ç”¨

```python
from src.communication.message_bus import MessageBus, Message, MessageType, MessagePriority

async def message_bus_example(system):
    """æ¶ˆæ¯æ€»çº¿ä½¿ç”¨ç¤ºä¾‹"""

    message_bus = system.message_bus

    # è®¢é˜…æ¶ˆæ¯
    async def task_completed_handler(message: Message):
        print(f"ğŸ“¨ æ”¶åˆ°ä»»åŠ¡å®Œæˆæ¶ˆæ¯ï¼š{message.payload}")

    await message_bus.subscribe("task.completed", task_completed_handler)

    # å‘å¸ƒæ¶ˆæ¯
    completion_message = Message(
        type=MessageType.EVENT,
        topic="task.completed",
        payload={
            "task_id": "task_123",
            "status": "success",
            "result": "ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ"
        },
        priority=MessagePriority.NORMAL,
        sender="system"
    )

    await message_bus.publish(completion_message)

    # ç­‰å¾…æ¶ˆæ¯å¤„ç†
    await asyncio.sleep(1)
```

#### 6.3.6 æ€§èƒ½ç›‘æ§

```python
from src.monitoring.langsmith_integration import EnterpriseTracing, TraceLevel

async def monitoring_example(system):
    """æ€§èƒ½ç›‘æ§ç¤ºä¾‹"""

    tracer = system.tracer

    # åˆ›å»ºè¿½è¸ªä¼šè¯
    with tracer.trace_session("custom_operation", TraceLevel.INFO) as session:
        # æ‰§è¡Œè¢«ç›‘æ§çš„æ“ä½œ
        session.log("å¼€å§‹æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ")

        # æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ
        await asyncio.sleep(2)

        session.log("æ“ä½œæ‰§è¡Œå®Œæˆ")
        session.add_metadata({
            "operation_type": "custom",
            "duration": "2s",
            "status": "success"
        })

    # è·å–æ€§èƒ½æŒ‡æ ‡
    metrics = await system._collect_system_metrics()
    print(f"ğŸ“ˆ ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼š{json.dumps(metrics, indent=2, ensure_ascii=False)}")
```

#### 6.3.7 é”™è¯¯å¤„ç†å’Œé‡è¯•

```python
import asyncio
from typing import Optional, Dict, Any

class AgentTaskManager:
    """æ™ºèƒ½ä½“ä»»åŠ¡ç®¡ç†å™¨"""

    def __init__(self, system: MultiAgentSystem):
        self.system = system
        self.max_retries = 3
        self.retry_delay = 1.0

    async def execute_with_retry(self,
                               agent_id: str,
                               task_data: Dict[str, Any],
                               max_retries: Optional[int] = None) -> Optional[Dict[str, Any]]:
        """å¸¦é‡è¯•æœºåˆ¶çš„ä»»åŠ¡æ‰§è¡Œ"""

        max_retries = max_retries or self.max_retries

        for attempt in range(max_retries + 1):
            try:
                agent = self.system.agents.get(agent_id)
                if not agent:
                    raise ValueError(f"æ™ºèƒ½ä½“ {agent_id} ä¸å­˜åœ¨")

                result = await agent.execute(task_data)

                if result.success:
                    print(f"âœ… ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼ˆå°è¯• {attempt + 1}/{max_retries + 1}ï¼‰")
                    return result.data
                else:
                    raise Exception(f"ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼š{result.error}")

            except Exception as e:
                print(f"âŒ å°è¯• {attempt + 1}/{max_retries + 1} å¤±è´¥ï¼š{e}")

                if attempt < max_retries:
                    await asyncio.sleep(self.retry_delay * (2 ** attempt))  # æŒ‡æ•°é€€é¿
                else:
                    print(f"ğŸš« ä»»åŠ¡æœ€ç»ˆå¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
                    return None

# ä½¿ç”¨ç¤ºä¾‹
async def retry_example(system):
    task_manager = AgentTaskManager(system)

    result = await task_manager.execute_with_retry(
        agent_id="research_agent",
        task_data={
            "query": "é‡å­è®¡ç®—å‘å±•ç°çŠ¶",
            "timeout": 30
        },
        max_retries=5
    )

    if result:
        print(f"ğŸ¯ æœ€ç»ˆç»“æœï¼š{result}")
    else:
        print("ğŸ’¥ ä»»åŠ¡æ‰§è¡Œå¤±è´¥")
```

## 7. ç›‘æ§å’Œè°ƒè¯•

**Docker Compose å¯åŠ¨æ—¶å¯ç”¨ï¼š**

- **Grafana é¢æ¿**ï¼š<http://localhost:3000> (admin/admin)
- **Prometheus æŒ‡æ ‡**ï¼š<http://localhost:9090>
- **API æ–‡æ¡£**ï¼š<http://localhost:8000/docs>
- **LangSmith è¿½è¸ª**ï¼š<https://smith.langchain.com>

**Python æœ¬åœ°å¯åŠ¨æ—¶å¯ç”¨ï¼š**

- **API æ–‡æ¡£**ï¼š<http://localhost:8000/docs>
- **å¥åº·æ£€æŸ¥**ï¼š<http://localhost:8000/health>
- **æŒ‡æ ‡æ¥å£**ï¼š<http://localhost:8000/metrics>
- **LangSmith è¿½è¸ª**ï¼š<https://smith.langchain.com>

---

> ğŸ’¡ **æç¤º**ï¼šæœ¬é¡¹ç›®åŸºäºã€Šå¤šæ™ºèƒ½ä½“ AI ç³»ç»ŸåŸºç¡€ï¼šç†è®ºä¸æ¡†æ¶ã€‹å®ç°ï¼Œå±•ç¤ºäº†ç†è®ºåˆ°å®è·µçš„å®Œæ•´è½¬åŒ–è¿‡ç¨‹ã€‚
